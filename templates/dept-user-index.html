{% extends 'base.html' %}
{% load filters %}
{% load static %}
{% block content %}
    <div id="loader" class="loader is-hidden"></div>
    <div id="app">
        <section class="section is-title-bar">
            <div class="level">
                <div class="level-left">
                    <div class="level-item">
                    </div>
                </div>
            </div>
        </section>
        <section class="hero is-hero-bar">
            <div class="hero-body">
                <div class="level">
                    <div class="level-left">
                        <div class="level-item"><h1 class="title" id="title">
                          Infratel Limited Budget Summary(ZMW)
                        </h1></div>
                    </div>
                    <div class="level-right">
                        
                        <div class="level-item">
                              <button class="button has-text-black " id="toggleCards" style="border: 0px">
                                        <span>Toggle Cards</span><span class="icon"><i
                                            class="mdi mdi-toggle-switch-outline mdi-24px"></i></span></button>
                          
                        </div>
                </div>
            </div>
            </div>
        </section>
        <section class="section is-main-section ">
        <div id="dashboard-cards">
            {% if request.user.role == '002' %}
            <div class="tile is-ancestor mb-3">
                <div class="tile is-ancestor mb-3" >
              <div class="tile is-parent is-flex is-justify-content-space-between is-align-content-center">
                  <div class="p-3 mr-2 is-flex-grow-1" style="background-color: white;border-radius: 6px; " >
                  <div class="has-text-centered has-text-weight-bold" >CAPEX Total</div>
                 <div class="tile " style=" background-color: white;">
                     <div  style=" position: relative;" class="card tile is-child ">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold" >
                                    
                                    Budget
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ capex_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                     <div  style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold" >
                                    
                                    Actual
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ capex_actual_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                 </div>
            </div>
                  <div class="p-3 mr-2 is-flex-grow-1" style="background-color: white;border-radius: 6px;" >
                       <div class="has-text-centered has-text-weight-bold" >{{ period }} Total</div>
                         <div class="tile " >
                            <div  style=" position: relative;" class="card tile is-child">
                          <div class="card-content" style="padding:0.25rem">
                            <div class="level is-mobile">
                              <div class="level-item">
                                <div class="is-widget-label">
                                  <p class="has-text-centered has-text-weight-bold" >
                                   Budget
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ period_total }}</p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                            <div style=" position: relative;" class="card tile is-child">
                              <div class="card-content" style="padding:0.25rem">
                                <div class="level is-mobile">
                                  <div class="level-item">
                                    <div class="is-widget-label">
                                      <p class="has-text-centered has-text-weight-bold">
                                     
                                    Actual
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ period_actual_total }}</p>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div style=" position: relative;" class="card tile is-child">
                              <div class="card-content" style="padding:0.25rem">
                                <div class="level is-mobile">
                                  <div class="level-item">
                                    <div class="is-widget-label">
                                      <p class="has-text-centered has-text-weight-bold">
                                    Pending
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ period_pending_total }}</p>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div style=" position: relative;" class="card tile is-child">
                          <div class="card-content" style="padding:0.25rem">
                            <div class="level is-mobile">
                              <div class="level-item">
                                <div class="is-widget-label">
                                  <p class="has-text-centered has-text-weight-bold">
                                     
                                    Available
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ period_available_total }}</p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                         </div>
                  </div>
                  <div class="p-3 mr-2 is-flex-grow-1" style="background-color: white;border-radius: 6px;" >
                      <div class="has-text-centered has-text-weight-bold" >YTD Total</div>
                      
                  <div class="tile">
                <div style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold">
                                    Budget
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ ytd_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold">
                                     
                                    Actual
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ ytd_actual_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                   <div style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold">
                                     
                                    Pending
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ ytd_pending_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold" >
                                    
                                    Available
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ ytd_available_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                  </div>
                    </div>
              </div>
            </div><!-- Capex Cards-->
            </div>
            {% endif %}
            <div class="tile is-ancestor mb-3"><!-- Opex Cards-->
                
              <div class="tile is-parent is-flex is-justify-content-space-between is-align-content-center">
                     
                  <div class="p-3 mr-2 is-flex-grow-1" style="background-color: white;border-radius: 6px; " >
                  <div class="has-text-centered has-text-weight-bold" >OPEX Total</div>
                 <div class="tile " style=" background-color: white;">
                     <div  style=" position: relative;" class="card tile is-child  ">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold" >
                                   
                                    Budget
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ opex_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                     <div  style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold" >
                              
                                    Actual
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ opex_actual_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                 </div>
            </div>
                  <div class="p-3 mr-2 is-flex-grow-1" style="background-color: white;border-radius: 6px;" >
                       <div class="has-text-centered has-text-weight-bold" >{{ period }} Total</div>
                         <div class="tile " >
                            <div  style=" position: relative;" class="card tile is-child">
                          <div class="card-content" style="padding:0.25rem">
                            <div class="level is-mobile">
                              <div class="level-item">
                                <div class="is-widget-label">
                                  <p class="has-text-centered has-text-weight-bold" >
                                   
                                    Budget
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ opex_period_total }}</p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                            <div style=" position: relative;" class="card tile is-child">
                              <div class="card-content" style="padding:0.25rem">
                                <div class="level is-mobile">
                                  <div class="level-item">
                                    <div class="is-widget-label">
                                      <p class="has-text-centered has-text-weight-bold" >
                                   
                                    Actual
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ opex_period_actual_total }}</p>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div style=" position: relative;" class="card tile is-child">
                              <div class="card-content" style="padding:0.25rem">
                                <div class="level is-mobile">
                                  <div class="level-item">
                                    <div class="is-widget-label">
                                      <p class="has-text-centered has-text-weight-bold" >
                                   
                                    Pending
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ opex_period_pending_total }}</p>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div style=" position: relative;" class="card tile is-child">
                          <div class="card-content" style="padding:0.25rem">
                            <div class="level is-mobile">
                              <div class="level-item">
                                <div class="is-widget-label">
                                  <p class="has-text-centered has-text-weight-bold" >
                                  
                                    Available
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ opex_period_available_total }}</p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                         </div>
                  </div>
                  <div class="p-3 mr-2 is-flex-grow-1" style="background-color: white;border-radius: 6px;" >
                      <div class="has-text-centered has-text-weight-bold" >YTD Total</div>
                      
                  <div class="tile">
                <div style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold" >
                              
                                    Budget
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ opex_ytd_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold" >
                               
                                    Actual
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ opex_ytd_actual_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                   <div style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold" >
                                 
                                    Pending
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ opex_ytd_pending_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold" >
                                   
                                    Available
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ opex_ytd_available_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                  </div>
                    </div>
              </div>
            </div>
            <!--<div class="tile is-ancestor mb-3">
                <div class="tile is-ancestor mb-3" >
              <div class="tile is-parent is-flex is-justify-content-space-between is-align-content-center">
                  <div class="p-3 mr-2 is-flex-grow-1" style="background-color: white;border-radius: 6px; " >
                  <div class="has-text-centered has-text-weight-bold" >Income Total</div>
                 <div class="tile " style=" background-color: white;">
                     <div  style=" position: relative;" class="card tile is-child ">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold" >
                                    
                                    Budget
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ income_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                     <div  style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold" >
                                    
                                    Actual
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ income_actual_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                 </div>
            </div>
                  <div class="p-3 mr-2 is-flex-grow-1" style="background-color: white;border-radius: 6px;" >
                       <div class="has-text-centered has-text-weight-bold" >{{ period }} Total</div>
                         <div class="tile " >
                            <div  style=" position: relative;" class="card tile is-child">
                          <div class="card-content" style="padding:0.25rem">
                            <div class="level is-mobile">
                              <div class="level-item">
                                <div class="is-widget-label">
                                  <p class="has-text-centered has-text-weight-bold" >
                                   Budget
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ income_period_total }}</p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                            <div style=" position: relative;" class="card tile is-child">
                              <div class="card-content" style="padding:0.25rem">
                                <div class="level is-mobile">
                                  <div class="level-item">
                                    <div class="is-widget-label">
                                      <p class="has-text-centered has-text-weight-bold">
                                     
                                    Actual
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ income_period_actual_total }}</p>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                         
                         </div>
                  </div>
                  <div class="p-3 mr-2 is-flex-grow-1" style="background-color: white;border-radius: 6px;" >
                      <div class="has-text-centered has-text-weight-bold" >YTD Total</div>
                      
                  <div class="tile">
                <div style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold">
                                    Budget
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ income_ytd_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div style=" position: relative;" class="card tile is-child">
                  <div class="card-content" style="padding:0.25rem">
                    <div class="level is-mobile">
                      <div class="level-item">
                        <div class="is-widget-label">
                          <p class="has-text-centered has-text-weight-bold">
                                     
                                    Actual
                                  </p>
                                  <p style="font-size: xx-small;font-weight:bolder">{{ income_ytd_actual_total }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                  </div>
                    </div>
              </div>
            </div>
            </div>-->
        </div>
            <div class="card has-table has-mobile-sort-spaced">
              
                     <div class="level " style="margin-top:0.5rem;margin-bottom:1rem; font-weight:bold;">
                                        <div class="level-left">
                                            <a class="jb-modal ml-2" data-target="index-account-search-modal">Dashboard Search <i class="mdi mdi-search-web mdi-24px is right"></i></a>
                                        </div>
                                        <div class="level-right">

                                         <div class="select">
                                                <select class="select is-outlined mr-2" style="border:0;" name="quarter_select" id="quarter_select">

                                                    <option disabled selected >
                                                        Change Budget Information(Current:{{ period }})
                                                    </option>
                                                    <option value="netperd1" >Jan
                                                    </option>
                                                    <option value="netperd2" >Feb

                                                    </option>
                                                    <option value="netperd3" >Mar
                                                    </option>
                                                    <option value="netperd4" >Apr
                                                    </option>
                                                    <option value="netperd5" >May
                                                    </option>
                                                    <option value="netperd6" >Jun

                                                    </option>
                                                    <option value="netperd7" >Jul
                                                    </option>
                                                    <option value="netperd8" >Aug
                                                    </option>
                                                    <option value="netperd9" >Sept
                                                    </option>
                                                    <option value="netperd10" >Oct
                                                    </option>
                                                    <option value="netperd11" >Nov
                                                    </option>
                                                    <option value="netperd12" >Dec
                                                    </option>
                                                     <option value="1" >Q1
                                                    </option>
                                                    <option value="2" >Q2
                                                    </option>
                                                    <option value="3" >Q3
                                                    </option>
                                                    <option value="4" >Q4
                                                    


                                                </select>
                                         </div>
                             <div class="select ">
                                                <select class="select is-outlined mr-2"  id="bs_select" style="border:0" name="budget_set"
                                                        >

                                                    <option disabled selected >
                                                        Budget Variation(Default: budget 1)
                                                    </option>
                                                    <option value="Budget 1" >Budget Set
                                                        1
                                                    </option>
                                                    <option value="Budget 2" >Budget Set
                                                        2
                                                    </option>
                                                    <option value="Budget 3" >Budget Set 3
                                                    </option>

                                                </select></div>
                                           
                                        </div>
                     </div>
                        <div class="table-wrapper has-mobile-cards p-2"
                             style="overflow:auto;max-height:500px;">
                            <table id="budget-total" class="table is-fullwidth is-striped is-hoverable is-sortable is-narrow "
                                   role="grid">
                                <thead >
                                <tr class="p-1">
                                    <th rowspan="1" class="card-header-icon"></th>
                                    <th rowspan="1" class="account-code is-hidden has-text-right"></th>
                                    <th colspan="4" class="has-text-centered">{{ period }}</th>
                                    <th colspan="4" class="has-text-centered">YTD</th>
                                </tr>
                                <tr>

                                    <th class="card-header-icon">Unit Name</th>
                                    <th class="account-code is-hidden has-text-right">Account Code</th>
                                    <th class="has-text-right">Budget</th>
                                     <th class="has-text-right">Actual</th>
                                    <th class="has-text-right">Pending</th>
                                    <th class="has-text-right">Available</th>
                                    <th class="has-text-right">Budget</th>
                                      <th class="has-text-right">Actual</th>
                                      <th class="has-text-right">Pending</th>
                                      <th class="has-text-right">Available</th>

                                </tr>
                                </thead>
                                <tbody class="budget-table-body"  role="rowgroup">
                                {% for acc in data.dept_totals %}
                                    {% if acc %}
                                        <tr role="row" class="accordion-row" >
                                            <td data-label="Account name" style=" position: sticky;background-color: white;" class="button card-header-icon accordion-button1" data-dept="{{ acc.id }}"><b>{{ acc.acctdesc }}</b></td>
                                            <td class="account-code is-hidden" ></td>
                                            <td class="has-text-right">{{ acc.total }}</td>
                                            <td class="has-text-right actualBtn" data-dept="{{ acc.id }}">{{ acc.total_actual}}</td>
                                            <td class="has-text-right pendingBtn" style="font-size: 1em;padding: 0.75rem 1rem; text-align: right;" data-dept="{{ acc.id }}">{{ acc.pending }}</td>
                                            <td class="has-text-right">{{ acc.available }}</td>
                                            <td class="has-text-right" data-label="Jan">{{ acc.year_total}}</td>
                                            <td class="has-text-right actualBtn" data-label="Jan" data-dept="{{ acc.id }}">{{ acc.year_total_actual}}</td>
                                            <td class="has-text-right pendingBtn" style="font-size: 1em;padding: 0.75rem 1rem; text-align: right;"  data-dept="{{ acc.id }}" data-label="Apr">{{ acc.pending_year_total }}</td>
                                            <td class="has-text-right"  data-label="Apr">{{ acc.available_year_total }}</td>
                                        </tr>

                                    {% else %}
                                        <tr role="row">
                                            No budget to show.
                                        </tr>
                                    {% endif %}
                                {% endfor %}


                                </tbody>
                            
                            </table>
                            <table id="budget-total-all" class="table is-hidden is-fullwidth is-striped is-hoverable is-sortable is-narrow "
                                   role="grid">
                                <thead >
                                 <tr>
                                    <th rowspan="1"></th>
                                    <th rowspan="1" class="account-code is-hidden"></th>
                                    <th colspan="4" class="has-text-centered">Q1</th>
                                    <th colspan="4" class="has-text-centered">Q2</th>
                                    <th colspan="4" class="has-text-centered">Q3</th>
                                    <th colspan="4" class="has-text-centered">Q4</th>
                                    <th colspan="4" class="has-text-centered">H1</th>
                                    <th colspan="5" class="has-text-centered">H2</th>
                                    <th colspan="4" class="has-text-centered">YRT</th>
                                </tr>
                                <tr>
                                    <th>Account Name</th>
                                    <th class="account-code is-hidden">Account Code</th>
                                    <th id="q1-accordion" class=" has-text-right" style="font-family: inherit;font-size: 1em;">Q1(Budget)</th>
                                    <th class="q1 is-hidden has-text-right">Q1(Actual)</th>
                                    <th class="q1 is-hidden has-text-right">Q1(Pending)</th>
                                    <th class="q1 is-hidden has-text-right">Q1(Available)</th>
                                    <th id="q2-accordion" class="has-text-right" style="font-family: inherit;font-size: 1em;">Q2(Budget)</th>
                                    <th class="q2 is-hidden has-text-right">Q2(Actual)</th>
                                    <th class="q2 is-hidden has-text-right">Q2(Pending)</th>
                                    <th class="q2 is-hidden has-text-right">Q2(Available)</th>
                                   <th id="q3-accordion" class="has-text-right" style="font-family: inherit;font-size: 1em;">Q3(Budget)</th>
                                    <th class="q3 is-hidden has-text-right">Q3(Actual)</th>
                                    <th class="q3 is-hidden  has-text-right">Q3(Pending)</th>
                                    <th class="q3 is-hidden has-text-right">Q3(Available)</th>
                                    <th id="q4-accordion"  class="has-text-right" style="font-family: inherit;font-size: 1em;">Q4(Budget)</th>
                                    <th class="q4 is-hidden has-text-right">Q4(Actual)</th>
                                    <th class="q4 is-hidden has-text-right">Q4(Pending)</th>
                                    <th class="q4 is-hidden has-text-right">Q4(Available)</th>
                                    <th id="h1-accordion" class="has-text-right" style="font-family: inherit;font-size: 1em;">H1(Budget)</th>
                                    <th class="h1 is-hidden has-text-right">H1(Actual)</th>
                                    <th class="h1 is-hidden has-text-right">H1(Pending)</th>
                                    <th class="h1 is-hidden has-text-right">H1(Available)</th>
                                    <th id="h2-accordion" class="has-text-right" style="font-family: inherit;font-size: 1em;">H2(Budget)</th>
                                    <th class="h2 is-hidden has-text-right">H2(Actual)</th>
                                    <th class="h2 is-hidden has-text-right">H2(Actual)</th>
                                    <th class="h2 is-hidden has-text-right">H2(Actual)</th>
                                    <th class="h2 is-hidden has-text-right">H2(Actual)</th>
                                    <th id="yrt-accordion" class="has-text-right" style="font-family: inherit;font-size: 1em;">YRT(Budget)</th>
                                    <th class="yrt is-hidden has-text-right">YRT(Actual)</th>
                                    <th class="yrt is-hidden has-text-right">YRT(Pending)</th>
                                    <th class="yrt is-hidden has-text-right">YRT(Available)</th>
                                </tr>
                                </thead>
                                <tbody class="budget-table-body"  role="rowgroup">
                                {% for acc in data.dept_totals %}
                                    {% if acc %}
                                        <tr role="row" class="accordion-row" >
                                            <td data-label="Account name" class="button card-header-icon {% if request.user.role == '002' %}accordion-button1-all{% endif %}" data-dept="{{ acc.id }}" style=" position: sticky;
                left: 0;
                top: 0;

                background-color: white;"><b>{{ acc.acctdesc }}</b></td>
                                        <td class="account-code is-hidden"></td>
                                            <td class="has-text-right">{{ acc.Q1.total }}</td>
                                            <td class="has-text-right is-hidden q1">{{ acc.Q1.total_actual }}</td>
                                            <td class="has-text-right is-hidden q1">{{ acc.Q1.pending }}</td>
                                            <td class="has-text-right is-hidden q1">{{ acc.Q1.available }}</td>
                                            <td class="has-text-right">{{ acc.Q2.total }}</td>
                                            <td class="has-text-right is-hidden q2">{{ acc.Q2.total_actual }}</td>
                                            <td class="has-text-right is-hidden q2">{{ acc.Q2.pending }}</td>
                                            <td class="has-text-right is-hidden q2">{{ acc.Q2.available }}</td>
                                            <td class="has-text-right">{{ acc.Q3.total }}</td>
                                            <td class="has-text-right is-hidden q3">{{ acc.Q3.total_actual }}</td>
                                            <td class="has-text-right is-hidden q3">{{ acc.Q3.pending }}</td>
                                            <td class="has-text-right is-hidden q3">{{ acc.Q3.available }}</td>
                                            <td class="has-text-right">{{ acc.Q4.total }}</td>
                                            <td class="has-text-right is-hidden q4">{{ acc.Q4.total_actual }}</td>
                                            <td class="has-text-right is-hidden q4">{{ acc.Q4.pending }}</td>
                                            <td class="has-text-right is-hidden q4">{{ acc.Q4.available }}</td>
                                            <td class="has-text-right">{{ acc.H1.total }}</td>
                                            <td class="has-text-right is-hidden h1">{{ acc.H1.total_actual }}</td>
                                            <td class="has-text-right is-hidden h1">{{ acc.H1.pending }}</td>
                                            <td class="has-text-right is-hidden h1">{{ acc.H1.available }}</td>
                                            <td class="has-text-right">{{ acc.H2.total }}</td>
                                            <td class="has-text-right is-hidden h2">{{ acc.H2.total_actual }}</td>
                                            <td class="has-text-right is-hidden h2">{{ acc.H2.pending }}</td>
                                            <td class="has-text-right is-hidden h2">{{ acc.H2.available }}</td>
                                            <td class="has-text-right">{{ acc.YRT.total }}</td>
                                            <td class="has-text-right is-hidden yrt">{{ acc.YRT.total_actual }}</td>
                                            <td class="has-text-right is-hidden yrt">{{ acc.YRT.pending }}</td>
                                            <td class="has-text-right is-hidden yrt">{{ acc.YRT.available }}</td>
                                            
                                        </tr>

                                    {% else %}
                                        <tr role="row">
                                            No data to show
                                        </tr>
                                    {% endif %}
                                {% endfor %}


                                </tbody>
                            </table>

                        </div>
                    </div>
        </section>
    </div>
    {% include 'partials/index-account-search-modal.html' %}
{% endblock %}
{% block extra-scripts %}
    <script>
    let variables = {}
    const searchInput = document.getElementById('dashboard-search')
    const select = document.getElementById('quarter_select');
    const budgetSetSelect = document.getElementById('bs_select');
    let currentDate = new Date();
    // Calculate the current quarter
    let currentMonth = currentDate.getMonth() + 1; // Adding 1 because getMonth() returns zero-based index
    // Set the default value of 'quarter' to the current quarter
    let defaultPeriodValue = 'netperd'+currentMonth
    let defaultBudgetSet = 'Budget 1'
    function addEventListenerToInputSearch() {
        const inputs = document.getElementById('dashboard-search')
        let sBudgetSet =variables['budget_set']||defaultBudgetSet
        let sPeriod =variables['period']||defaultPeriodValue
        let selectedFilter 
        const dept = inputs.getAttribute('data-dept')
        if (inputs) {
            
                const fieldBody = inputs.closest('.modal');
                const criteriaSelect = fieldBody.querySelector('#index-search-criteria');
                const currentTableBody = fieldBody.querySelector('#index-search-table-body');
                criteriaSelect.addEventListener('change', (ev) => {
                    inputs.removeAttribute('disabled');
                    selectedFilter = ev.target.value;
                });
                inputs.addEventListener('input', (ev) => {
                    const val = ev.target.value.trim();

                    if (val === "") {
                        currentTableBody.innerHTML = "";
                        return;
                    }
                    if (dept){
                    // Fetch data based on search criteria
                    fetch(`/dashboard/content/search?filter=${selectedFilter}&value=${val}&period=${sPeriod}&budget_set=${sBudgetSet}&department=${dept}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json()
                        })
                        .then(result => {
                           
                            const data = result.data.dept_totals
                           currentTableBody.innerHTML = "";
                            data.forEach(acc => {
                                 var newRow = document.createElement("tr");
                                    newRow.setAttribute("role", "row");
                                    
                                    var anchorId = document.createElement('a');
                                    anchorId.href = `/dashboard/content/search/results/${acc.acctid}`
                                    anchorId.style.fontSize = '0.9em;',
                                    
                                        anchorId.setAttribute("data-label", "Account name");
                                    anchorId.textContent = acc.acctdesc.trim().toLowerCase(); // Assuming acc.acctdesc contains the account name
                                    var accountNameCell = document.createElement("td");
                                    accountNameCell.appendChild(anchorId)
                                    newRow.appendChild(accountNameCell);
                                    var acctdescCell = document.createElement("td");
                                    acctdescCell.textContent = acc.acctid.trim(); // Assuming acc.Q1 contains the Q1 value
                                    acctdescCell.style.fontSize = '0.9em';
                                        newRow.appendChild(acctdescCell);
                                        // Append the new row to the table body
                                currentTableBody.appendChild(newRow);
                            })
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
               
                    }// Add the handleClick function as the event listener}
                    else{
                    fetch(`/dashboard/content/search?filter=${selectedFilter}&value=${val}&period=${sPeriod}&budget_set=${sBudgetSet}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json()
                        })
                        .then(result => {
                           
                            const data = result.data.dept_totals
                           currentTableBody.innerHTML = "";
                            data.forEach(acc => {
                                 var newRow = document.createElement("tr");
                                    newRow.setAttribute("role", "row");
                                    
                                    var anchorId = document.createElement('a');
                                    anchorId.href = `/dashboard/content/search/results/${acc.acctid}`
                                    anchorId.classList.add("card-header-icon");
                                    anchorId.style.fontSize = '0.9em;',
                                    
                                        anchorId.setAttribute("data-label", "Account name");
                                    anchorId.textContent = acc.acctdesc.trim().toLowerCase(); // Assuming acc.acctdesc contains the account name
                                    var accountNameCell = document.createElement("td");
                                    accountNameCell.appendChild(anchorId)
                                    newRow.appendChild(accountNameCell);
                                    var acctdescCell = document.createElement("td");
                                    acctdescCell.textContent = acc.acctid.trim(); // Assuming acc.Q1 contains the Q1 value
                                    acctdescCell.style.fontSize = '0.9em';
                                        newRow.appendChild(acctdescCell);
                                        // Append the new row to the table body
                                currentTableBody.appendChild(newRow);
                            })
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    }
                });
        // Add the handleClick function as the event listener
                    
        } else {
        }
    }
    addEventListenerToInputSearch() 
function addActualEventListener() {
    try {
        let selectedPeriod = variables['period'] || defaultPeriodValue;
        const pendingBtn = document.querySelectorAll(`[class*="has-text-right actualBtn"]`);
        
        pendingBtn.forEach(btn => {
            let dept = btn.dataset.dept;
            let url =  `/actual/${dept}?period=${selectedPeriod}`;
            
           
            
            btn.addEventListener('click', () => {
                window.location.href = url;
            });
        });
    } catch (error) {
        console.error('Error in addPendingEventListener:', error);
    }
}
function addPendingEventListener() {
    try {
        let selectedPeriod = variables['period'] || defaultPeriodValue;
        const pendingBtn = document.querySelectorAll(`[class*="has-text-right pendingBtn"]`);
        
        pendingBtn.forEach(btn => {
            let dept = btn.dataset.dept;
            let url =  `/pending/${dept}?period=${selectedPeriod}`;
            
           
            
            btn.addEventListener('click', () => {
                window.location.href = url;
            });
        });
    } catch (error) {
        console.error('Error in addPendingEventListener:', error);
    }
}

    addPendingEventListener()
    addActualEventListener()
    // Add an event listener to the select element
    select.addEventListener('change', function () {
        // Get the selected value

        const selectedValue = select.value;
        let url =``
        variables['period']=selectedValue
        let sBudgetSet =variables['budget_set']||defaultBudgetSet
        if (selectedValue.includes('netperd')){
             url = `/home/department?period=${selectedValue}&budget_set=${sBudgetSet}`
        }
        else{
             url = `/home/department?quarter=${selectedValue}&budget_set=${sBudgetSet}`
        }

        // Send a fetch request to the endpoint /home with the selected value as a query parameter
        fetch(url)
        .then(response => response.text())
        .then(data => {
            if (selectedValue === 'all') {
                const parser = new DOMParser();
                const newDoc = parser.parseFromString(data, 'text/html');
                const newHeader = newDoc.getElementById('dashboard-cards')
                const oldHeader = document.getElementById('dashboard-cards')
                const newTable = newDoc.getElementById('budget-total-all')
                newTable.classList.remove('is-hidden')
                const oldTable = document.getElementById('budget-total')
                // Replace the DOM contents with the new data
                oldTable.replaceWith(newTable);
                addEventListenersToTable()
                addPendingEventListener()
                addActualEventListener()
                oldHeader.replaceWith(newHeader)
                addPendingEventListener()
                addActualEventListener()
                

            }else {
                // Parse the HTML response
                const parser = new DOMParser();
                const newDoc = parser.parseFromString(data, 'text/html');
                const newHeader = newDoc.getElementById('dashboard-cards')
                const oldHeader = document.getElementById('dashboard-cards')
                const newTable = newDoc.getElementById('budget-total')

                const oldTable = document.getElementById('budget-total')


                if (oldTable) {
                    oldTable.replaceWith(newTable);
                    addEventListenersToTable()
                    
                    addPendingEventListener()
                    addActualEventListener()
                } else {
                    document.getElementById('budget-total-all').replaceWith(newTable);
                    addEventListenersToTable()
                    
                    addPendingEventListener()
                    addActualEventListener()

                }
                oldHeader.replaceWith(newHeader)
            }
                
            
            // Replace the DOM contents with the new data
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
    budgetSetSelect.addEventListener('change', function () {
        // Get the selected value
        const selectedValue = budgetSetSelect.value;
       variables['budget_set']=selectedValue
        let url
        let cPeriod =variables['period']||defaultPeriodValue
        let sBudgetSet =variables['budget_set']||defaultBudgetSet
        if (cPeriod.includes('netperd')){
             url = `/home/department?period=${cPeriod}&budget_set=${sBudgetSet}`
        }
        else{
             url = `/home/department?quarter=${cPeriod}&budget_set=${sBudgetSet}`
        }
        // Send a fetch request to the endpoint /home with the selected value as a query parameter
        fetch(url)
        .then(response => response.text())
        .then(data => {
            if (variables['period'] === 'all') {
                const parser = new DOMParser();
                const newDoc = parser.parseFromString(data, 'text/html');
                 const newHeader = newDoc.getElementById('dashboard-cards')
                const oldHeader = document.getElementById('dashboard-cards')
                const newTable = newDoc.getElementById('budget-total-all')
                newTable.classList.remove('is-hidden')
                const oldTable = document.getElementById('budget-total')
                // Replace the DOM contents with the new data
                oldTable.replaceWith(newTable);
                addEventListenersToTable()
                oldHeader.replaceWith(newHeader)

            }else {
                // Parse the HTML response
                const parser = new DOMParser();
                const newDoc = parser.parseFromString(data, 'text/html');
                const newHeader = newDoc.getElementById('dashboard-cards')
                const oldHeader = document.getElementById('dashboard-cards')
                const newTable = newDoc.getElementById('budget-total')

                const oldTable = document.getElementById('budget-total')


                if (oldTable) {
                    oldTable.replaceWith(newTable);
                    addEventListenersToTable()
                    
                    addPendingEventListener()
                    addActualEventListener()
                } else {
                    document.getElementById('budget-total-all').replaceWith(newTable);
                    addEventListenersToTable()
                    
                    addPendingEventListener()
                    addActualEventListener()

                }
                oldHeader.replaceWith(newHeader)
            }
                
            
            // Replace the DOM contents with the new data
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
    function addEventListenersToTable() {
        const accordion = document.querySelectorAll(`[class*="button card-header-icon accordion-button1"]`)
        if (accordion.length > 0) {
            accordion.forEach(accord => {
                let department = accord.dataset.dept
                let accordionContent
                let periodType
                let current_q
                if (select.value.includes('netperd')) {
                    periodType = 'month'
                    current_q = select.value
                } else if (select.value.includes( 'Change')) {
                    periodType = 'month'
                    current_q = `netperd${new Date().getMonth() + 1}`
                } else {
                    periodType = 'quarter'
                    current_q = select.value
                }
                accord.addEventListener("click", function () {
                    document.querySelectorAll(`[class*="account-code is-hidden"]`).forEach(function (element) {
                        element.classList.toggle('is-hidden')
                    })

                    if (department) {
                        accordionContent = document.querySelectorAll(`[class*="new-row-${department}"]`)
                        if (accordionContent.length > 0) {
                            accordionContent.forEach(function (element) {
                                element.classList.toggle('is-hidden');
                            });
                        } else {
                            let sPeriod =variables['period']||defaultPeriodValue
                            
                            fetch(`/dashboard/content?department=${department}&period_type=${periodType}&current_q=${current_q}`)
                                .then(response => {
                                    if (!response.ok) {
                                        throw new Error('Network response was not ok');
                                    }
                                    return response.json();
                                })
                                .then(data => {
                                    const dataObjs = data.data.dept_totals
                                    dataObjs.forEach((acc,index) => {
                                        // Create a new table row element
                                        const colors = ['#f0ffff', '#e6ffff']
                                        var newRow = document.createElement("tr");
                                        newRow.setAttribute("role", "row");
                                        newRow.classList.add(`new-row-${acc.id}`)
                                        newRow.style.backgroundColor = colors[index % colors.length]
                                        var anchorId = document.createElement('a');
                                        anchorId.href = `/dashboard/content/search/results/${acc.acctid}`
                                        anchorId.classList.add("card-header-icon");
                                        anchorId.style.fontSize = '0.9em;',

                                            anchorId.setAttribute("data-label", "Account name");
                                        anchorId.textContent = acc.acctdesc.trim(); // Assuming acc.acctdesc contains the account name
                                        var accountNameCell = document.createElement("td");
                                        accountNameCell.appendChild(anchorId)
                                        newRow.appendChild(accountNameCell);
                                        var acctdescCell = document.createElement("td");
                                        acctdescCell.textContent = acc.acctid.trim(); // Assuming acc.Q1 contains the Q1 value
                                        acctdescCell.style.fontSize = '0.9em';
                                        acctdescCell.classList.add("has-text-right");
                                        newRow.appendChild(acctdescCell);
                                        if (acc.table_type === "quarter") {
                                            var q1Cell = document.createElement("td");
                                            q1Cell.textContent = acc.total; // Assuming acc.Q1 contains the Q1 value
                                            q1Cell.style.fontSize = '0.9em',
                                            q1Cell.classList.add("has-text-right");
                                            newRow.appendChild(q1Cell);

                                            var q1aCell = document.createElement("td");
                                            q1aCell.textContent = acc.total_actual; // Assuming acc.Q1 contains the Q1 value
                                            q1aCell.style.fontSize = '0.9em',
                                            q1aCell.classList.add("has-text-right");
                                            newRow.appendChild(q1aCell);
                                            var pendingAnchorId = document.createElement('a');
                                            pendingAnchorId.href = `/pending/${acc.id}/?period=${sPeriod}&account=${acc.acctid.trim()}`
                                            pendingAnchorId.classList.add("has-text-black")
                                            
                                            pendingAnchorId.textContent = acc.pending;
                                            var q2Cell = document.createElement("td");
                                            q2Cell.classList.add("has-text-right")
                                            q2Cell.style.fontSize = '0.9em;',
                                            q2Cell.appendChild(pendingAnchorId)
                                            newRow.appendChild(q2Cell);
                                            var q2aCell = document.createElement("td");
                                            q2aCell.textContent = acc.available; // Assuming acc.Q2 contains the Q2 value
                                            q2aCell.style.fontSize = '0.9em',
                                            q2aCell.classList.add("has-text-right");
                                            newRow.appendChild(q2aCell);

                                            var h1Cell = document.createElement("td");
                                            h1Cell.setAttribute("data-label", "Budget Total");
                                            h1Cell.textContent = acc.year_total; // Assuming acc.H1 contains the H1 value
                                            h1Cell.style.fontSize = '0.9em',
                                            h1Cell.classList.add("has-text-right");
                                            newRow.appendChild(h1Cell);

                                            var h1aCell = document.createElement("td");
                                            h1aCell.setAttribute("data-label", "Budget Total");
                                            h1aCell.textContent = acc.year_total_actual; // Assuming acc.H1 contains the H1 value
                                            h1aCell.style.fontSize = '0.9em',
                                            h1aCell.classList.add("has-text-right");
                                            newRow.appendChild(h1aCell);
                                            var yearPendingAnchorId = document.createElement('a');
                                            yearPendingAnchorId.href = `/pending/${acc.id}/?period=${sPeriod}&account=${acc.acctid.trim()}`
                                            yearPendingAnchorId.classList.add("has-text-black");
                                            yearPendingAnchorId.textContent = acc.pending_year_total;
                                            var janCell = document.createElement("td");
                                            janCell.classList.add("has-text-right");
                                            janCell.style.fontSize = '0.9em',
                                            janCell.appendChild(yearPendingAnchorId)
                                            newRow.appendChild(janCell);
                                            var janaCell = document.createElement("td");
                                            janaCell.setAttribute("data-label", "Jan");
                                            janaCell.textContent = acc.available_year_total; // Assuming acc.Q3 contains the Q3 value
                                            janaCell.style.fontSize = '0.9em',
                                            janaCell.classList.add("has-text-right");
                                            newRow.appendChild(janaCell);


                                            // Append the new row to the table body
                                            var parentRow = this.parentElement;
                                            parentRow.parentNode.insertBefore(newRow, parentRow.nextSibling);
                                        } else {
                                            var q1Cell = document.createElement("td");
                                            q1Cell.textContent = acc.Q1; // Assuming acc.Q1 contains the Q1 value
                                            q1Cell.style.fontSize = '0.9em',
                                                q1Cell.style.backgroundColor = '#87CEEB'
                                            q1Cell.classList.add("has-text-right");
                                            newRow.appendChild(q1Cell);

                                            var q1aCell = document.createElement("td");
                                            q1aCell.textContent = acc.Q1A; // Assuming acc.Q1 contains the Q1 value
                                            q1aCell.style.fontSize = '0.9em',
                                                q1aCell.style.backgroundColor = '#F0FFFF'
                                            q1aCell.classList.add("has-text-right");
                                            newRow.appendChild(q1aCell);

                                            var q2Cell = document.createElement("td");
                                            q2Cell.textContent = acc.Q2; // Assuming acc.Q2 contains the Q2 value
                                            q2Cell.style.fontSize = '0.9em',
                                                q2Cell.style.backgroundColor = '#87CEEB'
                                            q2Cell.classList.add("has-text-right");
                                            newRow.appendChild(q2Cell);
                                            var q2aCell = document.createElement("td");
                                            q2aCell.textContent = acc.Q2A; // Assuming acc.Q2 contains the Q2 value
                                            q2aCell.style.fontSize = '0.9em',
                                                q2aCell.style.backgroundColor = '#F0FFFF'
                                            q2aCell.classList.add("has-text-right");
                                            newRow.appendChild(q2aCell);

                                            var h1Cell = document.createElement("td");
                                            h1Cell.setAttribute("data-label", "Budget Total");
                                            h1Cell.textContent = acc.H1; // Assuming acc.H1 contains the H1 value
                                            h1Cell.style.fontSize = '0.9em',
                                                h1Cell.style.backgroundColor = '#87CEEB'
                                            h1Cell.classList.add("has-text-right");
                                            newRow.appendChild(h1Cell);

                                            var h1aCell = document.createElement("td");
                                            h1aCell.setAttribute("data-label", "Budget Total");
                                            h1aCell.textContent = acc.H1A; // Assuming acc.H1 contains the H1 value
                                            h1aCell.style.fontSize = '0.9em',
                                                h1aCell.style.backgroundColor = '#F0FFFF'
                                            h1aCell.classList.add("has-text-right");
                                            newRow.appendChild(h1aCell);

                                            var janCell = document.createElement("td");
                                            janCell.setAttribute("data-label", "Jan");
                                            janCell.textContent = acc.Q3; // Assuming acc.Q3 contains the Q3 value
                                            janCell.style.fontSize = '0.9em',
                                                janCell.style.backgroundColor = '#87CEEB'
                                            janCell.classList.add("has-text-right");
                                            newRow.appendChild(janCell);
                                            var janaCell = document.createElement("td");
                                            janaCell.setAttribute("data-label", "Jan");
                                            janaCell.textContent = acc.Q3A; // Assuming acc.Q3 contains the Q3 value
                                            janaCell.style.fontSize = '0.9em',
                                                janaCell.style.fontSize = '0.9em',
                                                janaCell.classList.add("has-text-right");
                                            newRow.appendChild(janaCell);

                                            var febCell = document.createElement("td");
                                            febCell.setAttribute("data-label", "Feb");
                                            febCell.textContent = acc.Q4; // Assuming acc.Q4 contains the Q4 value
                                            febCell.style.fontSize = '0.9em',
                                                febCell.classList.add("has-text-right");
                                            newRow.appendChild(febCell);
                                            var febaCell = document.createElement("td");
                                            febaCell.setAttribute("data-label", "Feb");
                                            febaCell.textContent = acc.Q4A; // Assuming acc.Q4 contains the Q4 value
                                            febaCell.style.fontSize = '0.9em',
                                                febaCell.classList.add("has-text-right");
                                            newRow.appendChild(febaCell);

                                            var marCell = document.createElement("td");
                                            marCell.setAttribute("data-label", "Mar");
                                            marCell.textContent = acc.H2; // Assuming acc.H2 contains the H2 value
                                            marCell.style.fontSize = '0.9em',
                                                marCell.classList.add("has-text-right");
                                            newRow.appendChild(marCell);
                                            var maraCell = document.createElement("td");
                                            maraCell.setAttribute("data-label", "Mar");
                                            maraCell.textContent = acc.H2A; // Assuming acc.H2 contains the H2 value
                                            maraCell.style.fontSize = '0.9em',
                                                maraCell.classList.add("has-text-right");
                                            newRow.appendChild(maraCell);

                                            var aprCell = document.createElement("td");
                                            aprCell.setAttribute("data-label", "Apr");
                                            aprCell.textContent = acc.YRT; // Assuming acc.YRT contains the YRT value
                                            aprCell.style.fontSize = '0.9em',
                                                aprCell.classList.add("has-text-right");
                                            newRow.appendChild(aprCell);
                                            var aprsCell = document.createElement("td");
                                            aprsCell.setAttribute("data-label", "Apr");
                                            aprsCell.textContent = acc.YRTA; // Assuming acc.YRT contains the YRT value
                                            aprsCell.style.fontSize = '0.9em',
                                                aprsCell.classList.add("has-text-right");
                                            newRow.appendChild(aprsCell);
                                            // Append the new row to the table body
                                            var parentRow = this.parentElement;
                                            parentRow.parentNode.insertBefore(newRow, parentRow.nextSibling);
                                        }

                                    })

                                })
                        }


                    }
                })
            })
        }
         const accordionAll = document.querySelectorAll(`[class*="button card-header-icon accordion-button1-all"]`)

    if (accordionAll.length > 0) {
                accordionAll.forEach(accord => {
                    let department = accord.dataset.dept
                    let accordionContent

                    accord.addEventListener("click", function () {
                    document.querySelectorAll(`[class*="account-code is-hidden"]`).forEach(function (element){
                        element.classList.toggle('is-hidden')
                    })
                        
                        if (department) {
                            accordionContent = document.querySelectorAll(`[class*="new-row-${department}"]`)
                            if (accordionContent.length > 0) {
                                accordionContent.forEach(function (element) {
                                    element.classList.toggle('is-hidden');
                                });
                            } else {
                                fetch(`/dashboard/content/all?department=${department}`)
                                    .then(response => {
                                        if (!response.ok) {
                                            throw new Error('Network response was not ok');
                                        }
                                        return response.json();
                                    })
                                    .then(data => {
                                        const dataObjs = data.data.dept_totals
                                        dataObjs.forEach(acc => {
                                            // Create a new table row element
                                            var newRow = document.createElement("tr");
                                            newRow.setAttribute("role", "row");
                                            newRow.style.backgroundColor = '#E1EEF2';
                                            newRow.classList.add(`new-row-${acc.id}`)
                                            var anchorId = document.createElement('a');
                                            anchorId.href = `/update/${acc.objId}`
                                            anchorId.classList.add("card-header-icon");
                                            anchorId.style.fontSize = '0.9em',
                                                anchorId.setAttribute("data-label", "Account name");
                                            anchorId.textContent = acc.acctdesc.trim(); // Assuming acc.acctdesc contains the account name
                                            var accountNameCell = document.createElement("td");
                                            accountNameCell.appendChild(anchorId)
                                            newRow.appendChild(accountNameCell);
                                            var acctdescCell = document.createElement("td");
                                            acctdescCell.textContent = acc.acctid.trim(); // Assuming acc.Q1 contains the Q1 value
                                            acctdescCell.style.fontSize = '0.9em',
                                                newRow.appendChild(acctdescCell);

                                            var q1Cell = document.createElement("td");
                                            q1Cell.textContent = acc.Q1; // Assuming acc.Q1 contains the Q1 value
                                            q1Cell.style.fontSize = '0.9em',
                                                newRow.appendChild(q1Cell);

                                            var q1aCell = document.createElement("td");
                                            q1aCell.textContent = acc.Q1A; // Assuming acc.Q1 contains the Q1 value
                                            q1aCell.style.fontSize = '0.9em',
                                                newRow.appendChild(q1aCell);

                                            var q2Cell = document.createElement("td");
                                            q2Cell.textContent = acc.Q2; // Assuming acc.Q2 contains the Q2 value
                                            q2Cell.style.fontSize = '0.9em',
                                                newRow.appendChild(q2Cell);
                                            var q2aCell = document.createElement("td");
                                            q2aCell.textContent = acc.Q2A; // Assuming acc.Q2 contains the Q2 value
                                            q2aCell.style.fontSize = '0.9em',
                                                newRow.appendChild(q2aCell);

                                            var h1Cell = document.createElement("td");
                                            h1Cell.setAttribute("data-label", "Budget Total");
                                            h1Cell.textContent = acc.H1; // Assuming acc.H1 contains the H1 value
                                            h1Cell.style.fontSize = '0.9em',
                                                newRow.appendChild(h1Cell);

                                            var h1aCell = document.createElement("td");
                                            h1aCell.setAttribute("data-label", "Budget Total");
                                            h1aCell.textContent = acc.H1A; // Assuming acc.H1 contains the H1 value
                                            h1aCell.style.fontSize = '0.9em',
                                                newRow.appendChild(h1aCell);

                                            var janCell = document.createElement("td");
                                            janCell.setAttribute("data-label", "Jan");
                                            janCell.textContent = acc.Q3; // Assuming acc.Q3 contains the Q3 value
                                            janCell.style.fontSize = '0.9em',
                                                newRow.appendChild(janCell);
                                            var janaCell = document.createElement("td");
                                            janaCell.setAttribute("data-label", "Jan");
                                            janaCell.textContent = acc.Q3A; // Assuming acc.Q3 contains the Q3 value
                                            janaCell.style.fontSize = '0.9em',
                                                newRow.appendChild(janaCell);

                                            var febCell = document.createElement("td");
                                            febCell.setAttribute("data-label", "Feb");
                                            febCell.textContent = acc.Q4; // Assuming acc.Q4 contains the Q4 value
                                            febCell.style.fontSize = '0.9em',
                                                newRow.appendChild(febCell);
                                            var febaCell = document.createElement("td");
                                            febaCell.setAttribute("data-label", "Feb");
                                            febaCell.textContent = acc.Q4A; // Assuming acc.Q4 contains the Q4 value
                                            febaCell.style.fontSize = '0.9em',
                                                newRow.appendChild(febaCell);

                                            var marCell = document.createElement("td");
                                            marCell.setAttribute("data-label", "Mar");
                                            marCell.textContent = acc.H2; // Assuming acc.H2 contains the H2 value
                                            marCell.style.fontSize = '0.9em',
                                                newRow.appendChild(marCell);
                                            var maraCell = document.createElement("td");
                                            maraCell.setAttribute("data-label", "Mar");
                                            maraCell.textContent = acc.H2A; // Assuming acc.H2 contains the H2 value
                                            maraCell.style.fontSize = '0.9em',
                                                newRow.appendChild(maraCell);

                                            var aprCell = document.createElement("td");
                                            aprCell.setAttribute("data-label", "Apr");
                                            aprCell.textContent = acc.YRT; // Assuming acc.YRT contains the YRT value
                                            aprCell.style.fontSize = '0.9em',
                                                newRow.appendChild(aprCell);
                                            var aprsCell = document.createElement("td");
                                            aprsCell.setAttribute("data-label", "Apr");
                                            aprsCell.textContent = acc.YRTA; // Assuming acc.YRT contains the YRT value
                                            aprsCell.style.fontSize = '0.9em',
                                                newRow.appendChild(aprsCell);
                                            // Append the new row to the table body
                                            var parentRow = this.parentElement;
                                            parentRow.parentNode.insertBefore(newRow, parentRow.nextSibling);


                                        })

                                    })
                            }


                        }
                    })
                })
            }
    }
    
        addEventListenersToTable()

        
    
    </script>
{% endblock %}